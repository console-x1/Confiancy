const blacklistDomains = [
  '@tempmail.com',
  '@temp-mail.org',
  '@mailinator.com',
  '@mailinator.net',
  '@mailinator.org',
  '@10minutemail.com',
  '@10minutemail.net',
  '@10minutemail.co.uk',
  '@temp-mail.com',
  '@temp-mail.net',
  '@temp-mail.io',
  '@temp-mail.info',
  '@tempinbox.com',
  '@guerrillamail.com',
  '@guerrillamail.net',
  '@guerrillamail.de',
  '@yopmail.com',
  '@yopmail.fr',
  '@yopmail.net',
  '@yopmail.org',
  '@disposablemail.com',
  '@dispostable.com',
  '@maildrop.cc',
  '@maildrop.cf',
  '@getnada.com',
  '@nada.email',
  '@throwawaymail.com',
  '@trashmail.com',
  '@trashmail.net',
  '@tempmail.io',
  '@tempmail.co',
  '@tempmail.plus',
  '@fakeinbox.com',
  '@spambog.com',
  '@spambog.de',
  '@spamgourmet.com',
  '@spam4.me',
  '@mytemp.email',
  '@tempr.email',
  '@moakt.com',
  '@hotpop.com',
  '@jetable.org',
  '@sharklasers.com',
  '@notechmail.com',
  '@mailcatch.com',
  '@getairmail.com',
  '@0-mail.com',
  '@0wnd.net',
  '@proxymail.eu',
  '@10minutemail.pl',
  '@mailnull.com',
  '@fakebox.org',
  '@anonymbox.com',
  '@tempemail.net',
  '@tempemail.org',
  '@temporarymail.com',
  '@temporaryinbox.com',
  '@burnermail.io',
  '@burnermail.com',
  '@mailnesia.com',
  '@mohmal.com',
  '@mohmal.im',
  '@mailcatcher.me',
  '@mail-temporary.com',
  '@mail-temp.com',
  '@tempomail.org',
  '@sendspamhere.com',
  '@pookmail.com',
  '@emailtemporario.com.br',
  '@tempmailaddress.com',
  '@e4ward.com',
  '@emaillime.com',
  '@discard.email',
  '@discardmail.com',
  '@discardmail.de',
  '@mailforspam.com',
  '@yopmailbox.com',
  '@get1mail.com',
  '@mailinator2.com',
  '@trashmail.de',
  '@temp-mail.ru',
  '@emailondeck.com',
  '@onlinedelete.com',
  '@fakemailgenerator.com',
  '@fakemail.fr',
  '@guerrillamail.biz',
  '@spamtrapmail.com',
  '@tempmail.live',
  '@oneoffemail.com',
  '@spambox.info',
  '@spambox.org',
  '@receive-smth.com',
  '@wegwerfemail.de',
  '@mail-temporaire.fr',
  '@throwawaymail.net',
  '@tmail.ws',
  '@tempmailbox.com',
  '@tempemailbox.com',
  '@15minutemail.com',
  '@minuteinbox.com',
  '@gettempmail.com',
  '@meltmail.com',
  '@mailexpire.com',
  '@disposableemailaddresses.com',
  '@mail-temp.org',
  '@trashmail.ws',
  '@fastmailinbox.com',
  '@wegwerfmail.de',
  '@spamdecoy.net',
  '@yepmail.net',
  '@mail-guardian.com',
  '@tempemail.org',
  '@protempmail.com',
  '@tempmailo.com',
  '@tempmailk.com',
  '@mailin8r.com',
  '@nogmail.com',
  '@pokemail.net',
  '@tmailinator.com',
  '@trashmail.at',
  '@maildrop.top',
  '@temporary-mail.net',
  '@fakemail.net',
  '@mailnesia.org',
  '@spamfree24.org',
  '@throwawaymail.org',
  '@disposablemailbox.com',
  '@quickinbox.com',
  '@mail-temporaire.net',
  '@tempmailz.com',
  '@temp-mail.info',
  '@spamfightermail.com',
  '@tempmail.asia',
  '@nomail2me.com',
  '@yopmailbox.net',
  '@nowmymail.com',
  '@temporary-email.com',
  '@tempmails.net',
  '@tempmail.tech',
  '@safetmail.net',
  '@gettempmail.net',
  '@nowhere.org',
  '@mailsac.com',
  '@mailslurp.com',
  '@mailnesia.co',
  '@mailcatch.co',
  '@mail-temporaire.com',
  '@spamex.com',
  '@spamdecoy.org',
  '@ephemail.net',
  '@instant-mail.de',
  '@temp-mail.us',
  '@temp-mail.co',
  '@tempaddress.com',
  '@tempmail.de',
  '@tempmail.fr',
  '@tempmail.ru',
  '@temp-mail.ca',
  '@10minutemail.ru',
  '@10minutemail.org',
  '@10minutemail.co',
  '@10minutemail.info',
  '@10mail.org',
  '@trashmailbox.com',
  '@trashmailservice.com',
  '@trashmail.me',
  '@discard.email',
  '@discardmail.com',
  '@throwawayemail.com',
  '@throwawayemail.net',
  '@onewaymail.com',
  '@mailinator.org.uk',
  '@mailinator.co',
  '@mailinator.xyz',
  '@mailinator.email',
  '@mailinator.in',
  '@mailinator.me',
  '@anonymized.org',
  '@tempalias.com',
  '@tempmailer.com',
  '@tempmailpro.com',
  '@temp-mail.pro',
  '@temp-mail.biz',
  '@mail-temp.biz',
  '@fast-mail.org',
  '@fast-mail.com',
  '@fastinbox.net',
  '@fakemailgenerator.net',
  '@fakemailgenerator.org',
  '@fakemailgenerator.biz',
  '@fakemail.net',
  '@fakemail.org',
  '@burner-email.com',
  '@burner-email.net',
  '@burner-email.org',
  '@burnermail.net',
  '@burnermail.org',
  '@maildropmail.com',
  '@maildropmail.net',
  '@maildropmail.org',
  '@temp-mail.de',
  '@temp-mail.co.uk',
  '@temp-mail.info',
  '@10mail.com',
  '@10minemail.com',
  '@10minemail.net',
  '@10minemail.org',
  '@10minmail.com',
  '@10minmail.net',
  '@10minmail.org',
  '@temporarymail.net',
  '@temporary-mail.com',
  '@temporary-mail.net',
  '@temporaryinbox.net',
  '@temp-mail.online',
  '@tempmail.online',
  '@tempmail.website',
  '@tempmail.bid',
  '@tempmail.club',
  '@tempmail.online',
  '@tempmail.site',
  '@tempmail.space',
  '@tempmail.store',
  '@tempmail.today',
  '@tempmail.top',
  '@tempmail.xyz',
  '@tempmail.live',
  '@tempmail.tech',
  '@tempmail.cloud',
  '@tempmail.work',
  '@tempmail.email',
  '@tempmail.email',
  '@temp.email',
  '@temp.email.org',
  '@temp.email.net',
  '@temp.email.com',
  '@tempemailservice.com',
  '@tempemailservice.net',
  '@tempemailservice.org',
  '@temporary-mail.org',
  '@temporaryboxes.com',
  '@temporaryboxes.net',
  '@temporaryboxes.org',
  '@throwaway.email',
  '@throwawaymailbox.com',
  '@throwawaymailbox.net',
  '@throwawaymailbox.org',
  '@spammotel.com',
  '@spammotel.net',
  '@spammotel.org',
  '@spammer.xyz',
  '@spammer1.com',
  '@spamless.org',
  '@spamless.net',
  '@spamless.com',
  '@spamspot.com',
  '@spamspot.net',
  '@spamspot.org',
  '@mail-temp1.com',
  '@mail-temp2.com',
  '@mail-temp3.com',
  '@mail-temp4.com',
  '@meltmail.com',
  '@meltmail.net',
  '@meltmail.org',
  '@tempemail.me',
  '@tempemail.co',
  '@tempemail.online',
  '@tempmailpro.net',
  '@tempmailpro.org',
  '@tempmailpro.com',
  '@tempmailplus.com',
  '@tempmailplus.net',
  '@tempmailplus.org',
  '@10minuteemail.com',
  '@10minuteemail.net',
  '@10minuteemail.org',
  '@10minutesmail.com',
  '@10minutesmail.net',
  '@10minutesmail.org',
  '@mytempemail.com',
  '@mytemp.email',
  '@mytrashmail.com',
  '@mytrashmail.net',
  '@mytrashmail.org',
  '@spamexample.com',
  '@spamexample.net',
  '@spamexample.org',
  '@spamgourmet.net',
  '@spamgourmet.org',
  '@spambog.net',
  '@spambog.org',
  '@spambucket.com',
  '@spambucket.net',
  '@spambucket.org',
  '@mailinator.org.in',
  '@mailinator.org.au',
  '@mailinator.org.nz',
  '@mailinator.org.ca',
  '@mailinator.org.za',
  '@mailinator.org.ph',
  '@fakeinbox.net',
  '@fakeinbox.org',
  '@fakeinbox.co',
  '@fakeinbox.info',
  '@tempinbox.net',
  '@tempinbox.org',
  '@tempinbox.info',
  '@tempinbox.co',
  '@tmpmail.net',
  '@tmpmail.com',
  '@tmpmail.org',
  '@tmpmail.co',
  '@tempmailbox.net',
  '@tempmailbox.org',
  '@tempmailbox.co',
  '@tempmailbox.info',
  '@mailpoof.com',
  '@mailpoof.net',
  '@mailpoof.org',
  '@mailpoof.co',
  '@mailinatorapp.com',
  '@mailinatorapp.net',
  '@mailinatorapp.org',
  '@mailinatorapp.co',
  '@mailinatorapp.info',
  '@dropmail.me',
  '@dropmail.co',
  '@dropmail.xyz',
  '@dropmail.info',
  '@dropmail.org',
  '@dropmail.win',
  '@dropmail.club',
  '@dropmail.online',
  '@inboxbear.com',
  '@inboxbear.net',
  '@inboxbear.org',
  '@inboxbear.co',
  '@inboxbear.info',
  '@getairmail.net',
  '@getairmail.org',
  '@getairmail.co',
  '@getairmail.info',
  '@tempail.com',
  '@tempail.net',
  '@tempail.org',
  '@tempail.co',
  '@spamhole.com',
  '@spamhole.net',
  '@spamhole.org',
  '@spamhole.co',
  '@tempemailhub.com',
  '@tempemailhub.net',
  '@tempemailhub.org',
  '@tempemailhub.co',
  '@mailcatcher.co',
  '@mailcatcher.net',
  '@mailcatcher.org',
  '@mailcatcher.info',
  '@mailcatcher.co.uk',
  '@mailcatcher.de',
  '@mailcatcher.fr',
  '@mailcatcher.eu',
  '@spamcowboy.com',
  '@spamcowboy.net',
  '@spamcowboy.org',
  '@spamcowboy.co',
  '@spamcowboy.info',
  '@instantemail.co',
  '@instantemail.net',
  '@instantemail.org',
  '@instantemail.com',
  '@tempemailservice.com',
  '@tempemailservice.io',
  '@tempemailservice.co',
  '@tempemailservice.info',
  '@tempinboxservice.com',
  '@tempinboxservice.net',
  '@tempinboxservice.org',
  '@tempinboxservice.co',
  '@tempmailservice.com',
  '@tempmailservice.net',
  '@tempmailservice.org',
  '@tempmailservice.co',
  '@10minutemailbox.com',
  '@10minutemailbox.net',
  '@10minutemailbox.org',
  '@10minmailbox.com',
  '@10minmailbox.net',
  '@10minmailbox.org',
  '@1secmail.com',
  '@1secmail.net',
  '@1secmail.org',
  '@1secmail.info',
  '@1mail.xyz',
  '@1mail.net',
  '@1mail.org',
  '@1mail.co',
  '@mail-temporaire.fr',
  '@mail-temporaire.com',
  '@mail-temporaire.net',
  '@mail-temporaire.org',
  '@trashmailer.com',
  '@trashmailer.net',
  '@trashmailer.org',
  '@trashmailer.co',
  '@tempmailer.net',
  '@tempmailer.org',
  '@tempmailer.co',
  '@tempmailer.info',
  '@tempmailnow.com',
  '@tempmailnow.net',
  '@tempmailnow.org',
  '@tempmailnow.co',
  '@tempmailnow.info',
  '@mailnesia.co.uk',
  '@mailnesia.eu',
  '@mailnesia.de',
  '@mailnesia.info',
  '@spambox.me',
  '@spambox.co',
  '@spambox.biz',
  '@spambox.club',
  '@spambox.email',
  '@spambox.pro',
  '@tempmail365.com',
  '@tempmail365.net',
  '@tempmail365.org',
  '@tempmail365.co',
  '@tempmail365.info',
  '@temp-mail365.com',
  '@temp-mail365.net',
  '@temp-mail365.org',
  '@temp-mail365.co',
  '@temp-mail365.info',
  '@tempmail24.com',
  '@tempmail24.net',
  '@tempmail24.org',
  '@tempmail24.co',
  '@tempmail24.info',
  '@mailcatch24.com',
  '@mailcatch24.net',
  '@mailcatch24.org',
  '@mailcatch24.co',
  '@mailcatch24.info',
  '@burner-mail.com',
  '@burner-mail.net',
  '@burner-mail.org',
  '@burner-mail.co',
  '@burner-mail.info',
  '@throwawaymailbox.co',
  '@throwawaymailbox.info',
  '@throwawaymailbox.biz',
  '@throwawaymailbox.pro',
  '@temp-account.com',
  '@temp-account.net',
  '@temp-account.org',
  '@temp-account.co',
  '@temp-account.info',
  '@tempmail-generator.com',
  '@tempmail-generator.net',
  '@tempmail-generator.org',
  '@tempmail-generator.co',
  '@tempmail-generator.info',
  '@spamguard.net',
  '@spamguard.org',
  '@spamguard.co',
  '@spamguard.info',
  '@spamguard.biz',
  '@spamcheck.net',
  '@spamcheck.org',
  '@spamcheck.co',
  '@spamcheck.info',
  '@spamcheck.biz',
  '@nomail.info',
  '@nomail.pro',
  '@nomail.xyz',
  '@nomail.co',
  '@nomail.net',
  '@nospam.today',
  '@nospam.mail',
  '@nospam.email',
  '@nospam.org',
  '@nospam.net',
  '@inboxalias.com',
  '@inboxalias.net',
  '@inboxalias.org',
  '@inboxalias.co',
  '@inboxalias.info',
  '@inboxtemporary.com',
  '@inboxtemporary.net',
  '@inboxtemporary.org',
  '@inboxtemporary.co',
  '@inboxtemporary.info',
  '@placeholder.email',
  '@placeholdermail.com',
  '@placeholdermail.net',
  '@placeholdermail.org',
  '@placeholdermail.co',
  '@temporaryaddress.net',
  '@temporaryaddress.org',
  '@temporaryaddress.co',
  '@temporaryaddress.info',
  '@temporaryaddress.biz',
  '@throwaway365.com',
  '@throwaway365.net',
  '@throwaway365.org',
  '@throwaway365.co',
  '@throwaway365.info',
  '@quickmail.one',
  '@quickmail.xyz',
  '@quickmail.pro',
  '@quickmail.io',
  '@quickmail.org',
  '@mailtemp.org',
  '@mailtemp.net',
  '@mailtemp.co',
  '@mailtemp.info',
  '@mailtemp.biz',
  '@tempmailer365.com',
  '@tempmailer365.net',
  '@tempmailer365.org',
  '@tempmailer365.co',
  '@tempmailer365.info',
  '@temporarymailbox.com',
  '@temporarymailbox.net',
  '@temporarymailbox.org',
  '@temporarymailbox.co',
  '@temporarymailbox.info',
  '@deadmail.com',
  '@deadmail.net',
  '@deadmail.org',
  '@deadmail.co',
  '@deadmail.info',
  '@decoymail.com',
  '@decoymail.net',
  '@decoymail.org',
  '@decoymail.co',
  '@decoymail.info',
  '@nospam0.com',
  '@nospam0.net',
  '@nospam0.org',
  '@nospam0.co',
  '@nospam0.info',
  '@spamcannon.com',
  '@spamcannon.net',
  '@spamcannon.org',
  '@spamcannon.co',
  '@spamcannon.info',
  '@mailtempest.com',
  '@mailtempest.net',
  '@mailtempest.org',
  '@mailtempest.co',
  '@mailtempest.info',
  '@vanitymail.com',
  '@vanitymail.net',
  '@vanitymail.org',
  '@vanitymail.co',
  '@vanitymail.info',
  '@instantinbox.com',
  '@instantinbox.net',
  '@instantinbox.org',
  '@instantinbox.co',
  '@instantinbox.info',
  '@throwawaymailbox.today',
  '@burnermail.today',
  '@tempmail.today',
  '@disposable.today',
  '@maildrop.today',
  '@maildrop.today',
  '@tempmailproxy.com',
  '@tempmailproxy.net',
  '@tempmailproxy.org',
  '@tempmailproxy.co',
  '@tempmailproxy.info',
  '@shortlivedmail.com',
  '@shortlivedmail.net',
  '@shortlivedmail.org',
  '@shortlivedmail.co',
  '@shortlivedmail.info',
  '@vanishmail.com',
  '@vanishmail.net',
  '@vanishmail.org',
  '@vanishmail.co',
  '@vanishmail.info',
  '@ephemeralmail.com',
  '@ephemeralmail.net',
  '@ephemeralmail.org',
  '@ephemeralmail.co',
  '@ephemeralmail.info',
  '@tempbox.email',
  '@tempbox.mail',
  '@tempbox.co',
  '@tempbox.net',
  '@tempbox.org',
  '@nomailbox.net',
  '@nomailbox.org',
  '@nomailbox.co',
  '@nomailbox.info',
  '@nomailbox.biz',
  '@tempmailbox365.com',
  '@tempmailbox365.net',
  '@tempmailbox365.org',
  '@tempmailbox365.co',
  '@tempmailbox365.info',
  '@throwawaymail365.com',
  '@throwawaymail365.net',
  '@throwawaymail365.org',
  '@throwawaymail365.co',
  '@throwawaymail365.info',
  '@tempinbox365.com',
  '@tempinbox365.net',
  '@tempinbox365.org',
  '@tempinbox365.co',
  '@tempinbox365.info',
  '@mailscrap.com',
  '@mailscrap.net',
  '@mailscrap.org',
  '@mailscrap.co',
  '@mailscrap.info',
  '@mailtrash.com',
  '@mailtrash.net',
  '@mailtrash.org',
  '@mailtrash.co',
  '@mailtrash.info',
  '@mailthrowaway.com',
  '@mailthrowaway.net',
  '@mailthrowaway.org',
  '@mailthrowaway.co',
  '@mailthrowaway.info',
  '@slotmail.com',
  '@slotmail.net',
  '@slotmail.org',
  '@slotmail.co',
  '@slotmail.info',
  '@mail-temp-now.com',
  '@mail-temp-now.net',
  '@mail-temp-now.org',
  '@mail-temp-now.co',
  '@mail-temp-now.info',
  '@instantmailnow.com',
  '@instantmailnow.net',
  '@instantmailnow.org',
  '@instantmailnow.co',
  '@instantmailnow.info',
  '@temp4mail.com',
  '@temp4mail.net',
  '@temp4mail.org',
  '@temp4mail.co',
  '@temp4mail.info',
  '@papermail.xyz',
  '@papermail.one',
  '@papermail.pro',
  '@papermail.co',
  '@papermail.info',
  '@anonmail.com',
  '@anonmail.net',
  '@anonmail.org',
  '@anonmail.co',
  '@anonmail.info',
  '@dispomail.com',
  '@dispomail.net',
  '@dispomail.org',
  '@dispomail.co',
  '@dispomail.info',
  '@temp-mailbox.com',
  '@temp-mailbox.net',
  '@temp-mailbox.org',
  '@temp-mailbox.co',
  '@temp-mailbox.info',
  '@throwaway.email.net',
  '@throwaway.email.org',
  '@throwaway.email.co',
  '@throwaway.email.info',
  '@quicktemp.email',
  '@quicktemp.mail',
  '@quicktemp.co',
  '@quicktemp.net',
  '@quicktemp.org',
  '@fasttemp.email',
  '@fasttemp.mail',
  '@fasttemp.co',
  '@fasttemp.net',
  '@fasttemp.org',
  '@burneraccount.com',
  '@burneraccount.net',
  '@burneraccount.org',
  '@burneraccount.co',
  '@burneraccount.info',
  '@tempmailpro.io',
  '@tempmailpro.co',
  '@tempmailpro.biz',
  '@tempmailpro.info',
  '@tempmailpro.us',
  '@mailtemp.io',
  '@mailtemp.co',
  '@mailtemp.biz',
  '@mailtemp.info',
  '@mailtemp.us',
  '@mail-temp.io',
  '@mail-temp.co',
  '@mail-temp.biz',
  '@mail-temp.info',
  '@mail-temp.us',
  '@tempmailhq.com',
  '@tempmailhq.net',
  '@tempmailhq.org',
  '@tempmailhq.co',
  '@tempmailhq.info',
  '@tempmailhq.biz',
  '@tempmailhq.io',
  '@tempmailhq.us',
  '@tempinboxhq.com',
  '@tempinboxhq.net',
  '@tempinboxhq.org',
  '@tempinboxhq.co',
  '@tempinboxhq.info',
  '@dropmailhq.com',
  '@dropmailhq.net',
  '@dropmailhq.org',
  '@dropmailhq.co',
  '@dropmailhq.info',
  '@mailhazard.com',
  '@mailhazard.net',
  '@mailhazard.org',
  '@mailhazard.co',
  '@mailhazard.info',
  '@mailsentinel.com',
  '@mailsentinel.net',
  '@mailsentinel.org',
  '@mailsentinel.co',
  '@mailsentinel.info',
  '@temp-mail-service.com',
  '@temp-mail-service.net',
  '@temp-mail-service.org',
  '@temp-mail-service.co',
  '@temp-mail-service.info'
];

const fs = require('fs');
const path = require('path');
const crypto = require('crypto');

const blacklistPath = path.join(__dirname, 'blacklist.json');
const HMAC_KEY = process.env.HMAC_KEY_BLACKLIST;
const BLACKLIST_RETENTION_DAYS = 365;

function readBlacklist() {
  try {
    const data = fs.readFileSync(blacklistPath, 'utf8');
    return JSON.parse(data).bannedEntries || [];
  } catch (error) {
    console.error('[BLACKLIST] Error reading blacklist:', error);
    return [];
  }
}

function saveBlacklist(entries) {
  try {
    fs.writeFileSync(
      blacklistPath,
      JSON.stringify({ bannedEntries: entries }, null, 2)
    );
    return true;
  } catch (error) {
    console.error('[BLACKLIST] Error saving blacklist:', error);
    return false;
  }
}

function hmacEmail(email) {
  if (!email) return null;
  return crypto.createHmac('sha256', HMAC_KEY)
    .update(email.toLowerCase().trim())
    .digest('hex');
}

function addToBlacklist(email, reason) {
  if (!email || !reason) return false;
  const hash = hmacEmail(email);
  const now = new Date().toISOString();
  const expiresAt = new Date(Date.now() + BLACKLIST_RETENTION_DAYS * 24 * 60 * 60 * 1000).toISOString();

  const entries = readBlacklist();
  if (!entries.some(e => e.hash === hash)) {
    entries.push({ hash, addedAt: now, expiresAt, reason: reason });
    return saveBlacklist(entries);
  }
  return true;
}

function isBlacklisted(email) {
  if (!email) return false;
  email = email.toLowerCase().trim();

  if (disposableDomains.some(domain => email.endsWith(domain))) {
    return true;
  }

  const hash = hmacEmail(email);
  const entries = readBlacklist();
  return entries.some(e => e.hash === hash);
}

function purgeExpired() {
  const now = new Date();
  const entriesA = readBlacklist();
  const entriesB = entriesA.filter(e => !e.expiresAt || new Date(e.expiresAt) > now);
  if (entriesA.length === entriesB.length) return false;
  console.log(`[BLACKLIST] Purged ${entriesA.length - entriesB.length} expired entries.`.yellow);
  return saveBlacklist(entriesB);
}

module.exports = {
  isBlacklisted,
  addToBlacklist,
  purgeExpired,
};