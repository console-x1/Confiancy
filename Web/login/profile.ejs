<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= user.username %>
    </title>
    <link rel="stylesheet" href="../css/profile.css">
    <link rel="icon" href="../media/logoCircle.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
</head>

<body>
    <div class="container">
        <div class="glass-effect glass-1"></div>
        <div class="glass-effect glass-2"></div>

        <div class="profil-box">
            <img class="logo" src="<%= user.avatar ? user.avatar : '../media/defaultAvatar.png' %>" alt="Logo">

            <h1 class="header">
                <%= user.username %>
            </h1>

            <div class="score">
                <p><strong>Score :</strong> <%= Score %>/100 (<%= Count %> avis)</p>
            </div>

            <div class="avis">
                <br>
                <h2>Avis :</h2>
                <% const list = reviewsGrouped ? reviewsGrouped : []; %>
                <% if (list.length === 0) { %>
                    <p>Aucun avis.</p>
                <% } else { %>
                    <% list.forEach(r => { %>
                        <div class="review">
                            <p><strong>De :</strong> <a href="/user/<%= r.reviewerId %>"><%= r.reviewer %></a></p>
                            <p><strong>Note :</strong> <%= r.note %>/10</p>
                            <% if (r.comment) { %>
                                <p><strong>Commentaire :</strong> <%= r.comment %></p>
                            <% } %>
                            <p><em>Le <%= new Date(r.date).toLocaleDateString('fr-FR', {
                                    year: 'numeric',
                                    month: 'long',
                                    day: 'numeric'
                                }) %></em></p>
                        </div>
                    <% }) %>
                <% } %>
                <br>

                <% if (viewerId !== null && viewerId !== user.userId) { %>
                    <% if (alreadyReviewed) { %>
                        <p>Vous avez déjà laissé un avis.</p>
                    <% } else { %>
                        <form class="add-review" method="post" action="/api/reviews/<%= user.userId %>">
                            <label>Note (1-10): <input name="note" type="number" min="1" max="10" required></label>
                            <label>Commentaire: <input name="comment" type="text" autocomplete="off" minlength="10" maxlength="512"></label>
                            <button type="submit">Ajouter un avis</button>
                        </form>
                    <% } %>
                    <br>
                <% } %>
            </div>
        </div>
    </div>
</body>

</html>